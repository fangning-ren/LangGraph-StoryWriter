LAST_CHAPTER_SUMMARY_PROMPT = """
我正在撰写小说的（第 {_ChapterNum} 章），目前已完成以下内容。

我的提纲：
<OUTLINE>
{_Outline}
</OUTLINE>



本章（第{_ChapterNum} 章）大纲：
<CHAPTER_OUTLINE>
{_ThisOutline}
</CHAPTER_OUTLINE>

上一章（第{_LastChapterNum} 章）内容：
<PREVIOUS_CHAPTER>
{_LastChapter}
</PREVIOUS_CHAPTER>

您需要依据上一章（第{_LastChapterNum} 章）的具体内容，依据提纲中本章（第 {_ChapterNum} 章）的内容，指导下一章的写作。
请列出上一章的重要总结要点，以便我在撰写本章时知道需要注意哪些方面。不要总结整个提纲！
另外，请务必添加上一章的总结，并重点记下所有重要的情节点以及章节结束时的故事状态。
这样，当我写作时，我就能知道从哪里继续。

以下是一些格式指南：

```
上一章：
- 情节：
- 在此处填写要点总结，并尽可能详细地描述
- 背景：
- 此处填写一些内容
- 人物：
- 人物 1
- 上一章的人物信息
- 人物是否发生了变化，变化的原因是什么

需要注意的事项：
- 上一章为了推进情节而做了一些事情，因此我们将其融入到下一章
- 撰写下一章时需要记住的其他重要事项
- 其他事项
- 等等
```

感谢您帮助我撰写故事！请仅包含您的摘要和需要记住的事情，不要写任何其他内容。
"""

LAST_CHAPTER_SUMMARY_PROMPT = """
我正在撰写小说的（第 {_ChapterNum} 章），目前已完成以下内容。

我的提纲：
<OUTLINE>
{_Outline}
</OUTLINE>



本章（第{_ChapterNum} 章）大纲：
<CHAPTER_OUTLINE>
{_ThisOutline}
</CHAPTER_OUTLINE>

上一章（第{_LastChapterNum} 章）内容：
<PREVIOUS_CHAPTER>
{_LastChapter}
</PREVIOUS_CHAPTER>

您需要依据上一章（第{_LastChapterNum} 章）的具体内容，依据提纲中本章（第 {_ChapterNum} 章）的内容，指导下一章的写作。这样，当我写作时，我就能知道能从哪里继续。

### **任务要求**
**确保章节衔接顺畅**——用简短的方式说明上一章的结尾如何自然地引入本章的开头。
**控制 Token 数量**——总结后的提示词应尽量简洁，仅包含最重要的信息，而不是冗长的描述。
**提取关键情节点**——找出上一章中最重要的情节点，并将其与本章的情节进行对比，确保它们之间有良好的衔接。
**保留必要的人物信息**——确保人物的目标、情绪、互动关系得到保留，但不要罗列过多细节。    

### **输出格式**
请按照以下格式输出：
- **关键事件**：总结上一章（第{_LastChapterNum} 章）已有的，或需要添加的关键事件，使得本章（第 {_ChapterNum} 章）的情节能够发生。
- **场景连续**：判断上一章是否和本章发生在同一场景中。如果不是，请说明上一章的场景与本章情节的关联。
- **衔接要点**：概括本章应当以什么样的方式开始，以衔接上一章的结尾。
- **人物信息**：推测上一章中人物的情感状态是如何过度到本章的。

请仅输出精简的提示词，不需要添加额外评论。感谢您的帮助！

感谢您帮助我撰写故事！请仅包含您的摘要和需要记住的事情，不要写任何其他内容。
"""


NEXT_CHAPTER_CONNECT_PROMPT = """
您需要帮助我生成**精简而有效的写作提示词**，该提示词将用于撰写第 {_ChapterNum} 章。请依据**故事大纲**和**下一章（第{_NextChapterNum} 章）大纲**，提取出最重要的信息，并重新组织，使其简洁但仍然保持足够的指导性。  

### **参考信息**
故事大纲：
<OUTLINE>
{_Outline}
</OUTLINE>

本章（第{_ChapterNum} 章）大纲：
<CHAPTER_OUTLINE>
{_ThisOutline}
</CHAPTER_OUTLINE>

下一章（第{_NextChapterNum} 章）大纲：
<NEXT_CHAPTER_OUTLINE>
{_NextOutline}
</NEXT_CHAPTER_OUTLINE>


需要注意的事项：
- 本章为了推进情节而做了一些事情，使得下一章能够发生。如果您能思考，仔细思考本章的哪些事情会导致下一章的发生。

### **任务要求**
**确保章节衔接顺畅**——用简短的方式说明本章的结尾如何自然地引入下一章的开头。
**控制 Token 数量**——总结后的提示词应尽量简洁，仅包含最重要的信息，而不是冗长的描述。
**提取关键情节点**——找出本章中最重要的情节点，并将其与下一章的情节进行对比，确保它们之间有良好的衔接。
**保留必要的人物信息**——确保人物的目标、情绪、互动关系得到保留，但不要罗列过多细节。    

### **输出格式**
请按照以下格式输出：
- **关键事件**：总结本章（第{_ChapterNum} 章）已有的，或需要添加的关键事件，使得下一章（第{_NextChapterNum} 章）的情节能够发生。
- **衔接要点**：概括如何让本章的结尾自然地引入下一章的开头。
- **人物信息**：推测本章中人物的情感状态是如何过度到下一章的。

请仅输出精简的提示词，不需要添加额外评论。感谢您的帮助！
"""

SUMMARY_CHAPTER_PROMPT = """
请概括以下章节：

<CHAPTER>
{_Chapter}
</CHAPTER>

除了摘要之外，请勿在回复中包含任何其他内容。"""

SUMMARY_OUTLINE_PROMPT = """
请概括以下章节大纲：

<OUTLINE>
{_Outline}
</OUTLINE>

除了摘要之外，请勿在回复中包含任何其他内容。"""

SUMMARY_COMPARE_PROMPT = """
这是第{_ChapterNum}章的内容，请将它与第{_ChapterNum}章的提纲进行比较。

请使用以下键编写 JSON 格式的响应，不包含任何其他内容，这很重要。
请注意，计算机正在解析此 JSON，因此它必须正确无误。

第{_ChapterNum}章的内容：
<CHAPTER>
{_Chapter}
</CHAPTER>

第{_ChapterNum}章的提纲：
<OUTLINE>
{_Outline}
</OUTLINE>

请使用以下 JSON 字段进行响应：

{{
"Suggestions": str
"DidFollowOutline": true/false
}}

如果您认为章节内容与提纲大致相符，请将“DidFollowOutline”设置为 true，否则设置为 false。
如果您认为章节内容与提纲相符，"Suggestions" 应该是一个空字符串。

如果您认为章节内容与提纲不符，“Suggestions" 应包含一个包含详细 Markdown 格式反馈的字符串，用于指导作者。
请指定一些有助于作者进行修改的通用内容。
作者不会看到当前章节，因此针对当前章节的反馈没有帮助，而是应该指定需要注意提示或大纲中的内容。
作者也不知道每次迭代的具体内容，因此请在提示中提供有助于指导作者的详细信息。
建议的开头应为“写作时需要注意的重要事项：\n”。

摘要与内容不完全匹配也没关系，但应该具有大致相同的情节和节奏。

再次强调，请确保您的回复为 JSON 格式，且不包含任何多余的文字。它将直接输入到 JSON 解析器。
"""

# 这个prompt没法用。即便DeepSeek的context长度足够长，它也无法处理这段大概50k字的文本。产生的幻觉与原文完全不符。
# 看来使用langchain等框架进行提示词管理还是必要的。
SUMMARY_ALL_PROMPT = """
现在，提供整篇小说的内容。请以时间顺序概括所有的事件，省略不必要的描写和细节。
请确保您提供的内容是完整的，并且没有遗漏任何重要的事件或情节发展。

<CONTENT>

{_Content}

</CONTENT>

请问：故事中{_Character}的经历是怎样的？请将其总结为一段简短的文字，突出主要事件和情感变化。

"""