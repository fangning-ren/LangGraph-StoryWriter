import re

WHETHER_WRITE_OUTLINE_PROMPT = """
## 你接下来会需要判断用户提供的故事内容是否构成一个详细的大纲
用户给出了以下故事内容：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

请注意，用户的内容可能已经详细到能形成一个完整的故事大纲，其中包括每个章节的起承转合。

也有可能，用户有关于故事的内容只写了寥寥几句，或者只是一些零散的想法。

要求判断以下几点：
1. 用户提供的内容是否明确了**每一章**的故事情节？
2. 用户的内容是否明确按照章节划分了？
3. 用户提供的内容是否构成了一个完整的故事。
4. 用户的内容是否包含了足够多的情节间的因果关系？

只有当用户的内容满足以上所有条件时，才认为用户提供了一个完整的大纲。

请提供 JSON 格式的响应，其中包含字符串“IsOutline”和布尔值 True/False。
案例：
{{
  "IsOutline": true
}}

或者
{{
  "IsOutline": false
}}
请勿包含任何其他文本，只需包含 JSON 格式的响应，因为您的响应将由计算机解析。

"""

CLEAN_USER_PROMPT_PROMPT = """
用户给出了以下故事内容：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

这是用户提供的故事元素：
<STORY_ELEMENTS>
{_StoryElements}
</STORY_ELEMENTS>

这是整理后的故事大纲：
<OUTLINE>
{_Outline}
</OUTLINE>

在<USER_PROMPT>部分用户提供了很丰富的情节和故事元素，大部分已经包含在了<STORY_ELEMENTS>部分和<OUTLINE>部分中。你的任务是提取不包含在<STORY_ELEMENTS>和<OUTLINE>部分的用户需求，并将其整理成清晰的 Markdown 格式。

请从用户提供的内容中提取以下内容：
- 对故事的整体愿景和主题的描述
- 用户对情节的偏好，如着重描写的情感、动作、对话等
- 用户对细节的偏好，如角色服装，角色口头禅，细节描述侧重点等
- 用户对文风、节奏、主题等的要求
- 用户对章节长度的要求
- 用户不希望出现的内容或元素
请确保提取的内容是清晰和具体的，尽可能保留用户的原意和表达方式。请以以下格式输出：

# 故事标题
 [用户提供的故事标题，如果没有则从其他部分提取]

## 故事愿景和主题
- **概括**：精简地概括用户的故事情节。

## 用户偏好
  [列举用户对情节的偏好]

## 用户不希望出现的内容
  [列举用户不希望出现的内容]

"""

CLEAN_OUTLINE_PROMPT = """
用户给出了以下故事内容，其中已经包含完整的大纲：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

这是用户提供的故事元素：
<STORY_ELEMENTS>
{_StoryElements}
</STORY_ELEMENTS>

你主要做的是将用户的句子整理成 Markdown 格式的大纲。请尽最大可能保留用户的原文和细节。

你可以删除已经包括在<STORY_ELEMENTS>中的一些元素，例如：人物设定，背景设定，特殊物品设定，以及对文风、节奏、主题等的描述。

如果用户明确强调了某些因果关系，如“小明的行为使得小红感到开心，让小刚嫉妒” “某技能使得某人晕倒”等，请确保这些因果关系在大纲中得到体现。

如果用户对某一节有字数、节奏等要求，请保留这些要求。

如果用户强调某些人物在特定时刻会做出特定行为，或者有特定的情感反应，请确保这些重要细节被保留在大纲中。

对于用户声明"需要您创作具体细节"的部分，需要您根据用户的需求和故事元素，创作出具体的情节细节。请确保这些细节与用户的整体愿景和主题一致，然后将其添加到大纲中。

您的大纲应当能形成一个完整的故事结构。尽可能保留用户的原文。

注意：
- 绝对不要省略任何一个章节！
- 不要额外添加章节。
- 不要省略用户提供的任何重要情节或细节。
- 不要省略任何和因果关系有关的细节。
- 不要把模板中的 XML 标签以及模板中的示例内容包含在您的输出中。


"""

INITIAL_OUTLINE_PROMPT = """
请根据以下提示撰写一份 Markdown 格式的大纲：

<PROMPT>
{_Prompt}
</PROMPT>

<ELEMENTS>
{_StoryElements}
</ELEMENTS>

写作时，请记住问自己以下问题：
- 冲突是什么？
- 角色是谁（至少两个角色）？
- 角色之间彼此意味着什么？
- 角色在哪里？
- 风险是什么（风险高还是低？这里的风险是什么）？
- 冲突的目标或解决方案是什么？

不要直接回答这些问题，而是让你的大纲含蓄地回答它们。（展现，而不是讲述），这很重要。

请确保你的大纲清晰地说明哪些内容属于哪个章节。
确保在写作时添加大量细节。

此外，还要包含关于不同角色的信息，以及他们在故事发展过程中如何变化。
我们希望看到丰富而复杂的角色发展！"""

OUTLINE_REVISION_PROMPT = """
基于以下需求：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

请修改以下提纲：
<OUTLINE>
{_Outline}
</OUTLINE>

根据以下反馈：
<FEEDBACK>
{_Feedback}
</FEEDBACK>

请务必扩展您的提纲并添加内容，使其尽可能完美！

写作时，请牢记以下几点：
- 修改后的提纲中不应体现修改的痕迹。
- 修改后的提纲应为一完整提纲，不得遗漏任何关键情节。
- 不要添加额外的章节。
- 冲突是什么？
- 角色是谁（至少两个角色）？
- 角色之间彼此意味着什么？
- 我们在哪里？
- 利害关系是什么（是高还是低，这里的利害关系是什么）？
- 冲突的目标或解决方案是什么？

请确保您的提纲清晰地阐明哪些内容位于哪个章节。
确保在写作时添加大量细节。

不要直接回答这些问题，而是让您的写作含蓄地回答它们。（展现，而非诉说）
"""

CHAPTER_OUTLINE_PROMPT = """
请根据提供的提纲，为第 {_ChapterNum} 章生成提纲。
基于以下需求：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

<OUTLINE>
{_Outline}
</OUTLINE>

写作时，请牢记以下几点：
- 牢记用户的需求
- 冲突是什么？
- 角色是谁（至少两个角色）？
- 角色之间彼此意味着什么？
- 故事进展到了哪里？
- 利害关系是什么？
- 冲突的目标或解决方案是什么？

创建章节提纲时，请务必遵循提供的提纲。请保留原提纲相关章节的全部内容，并在此基础上扩展和细化。

不要直接回答这些问题，而是让你的提纲含蓄地回答这些问题。 （展示，而非讲述）

请将您的回答分解成几个场景，每个场景遵循以下格式（请为章节中的每个场景重复该场景格式）：

# 章节 {_ChapterNum}

## 场景：[简要场景标题]

- **人物与背景：**
- 角色：[角色名称] - [简要描述]
- 地点：[场景地点]
- 时间：[场景发生时间]

- **冲突与基调：**
- 冲突：[类型与描述]
- 基调：[情感基调]

- **情节概述：**
- [描述该场景的主要情节和发展，包含原提纲中该场景的内容]

- **关键事件与对话：**
- [描述重要事件、动作或对话]

- **文学手法：**
- [伏笔、象征或其他手法（如有）]

- **结局与引入：**
- [场景如何结束以及如何与下一个场景衔接]

再次强调，不要写章节只需创建章节的详细大纲即可。不得省略原提纲中第{_ChapterNum} 章的任何内容。并且该章节仅包含与第 {_ChapterNum} 章相关的内容，不得包含已经存在于上一章或下一章的内容。

确保您的章节名称符合 Markdown 格式！
"""

GET_IMPORTANT_BASE_INFO_PROMPT = """
请从以下用户提示中提取任何重要信息：

<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

只需写下提纲中未涵盖的任何信息即可。
请使用以下模板来格式化您的回复。
这些内容包括章节长度说明、整体愿景、格式说明等。
（请勿使用 XML 标签 - 这些仅供参考）

<示例>
# 重要补充说明
- 重点 1
- 重点 2
</示例>

请勿撰写提纲本身，只需添加一些补充说明即可。请保持您的回复简短。

"""

