import re

WHETHER_WRITE_OUTLINE_PROMPT = """
## 你接下来会需要判断用户提供的故事内容是否构成一个详细的大纲
用户给出了以下故事内容：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

请注意，用户的内容可能已经详细到能形成一个完整的故事大纲，其中包括每个章节的起承转合。

也有可能，用户有关于故事的内容只写了寥寥几句，或者只是一些零散的想法。

要求判断以下几点：
1. 用户提供的内容是否明确了**每一章**的故事情节？
2. 用户的内容是否明确按照章节划分了？
3. 用户提供的内容是否构成了一个完整的故事。
4. 用户的内容是否包含了足够多的情节间的因果关系？

只有当用户的内容满足以上所有条件时，才认为用户提供了一个完整的大纲。

请提供 JSON 格式的响应，其中包含字符串“IsOutline”和布尔值 True/False。
案例：
{{
  "IsOutline": true
}}

或者
{{
  "IsOutline": false
}}
请勿包含任何其他文本，只需包含 JSON 格式的响应，因为您的响应将由计算机解析。

"""

CLEAN_USER_PROMPT_PROMPT = """
用户给出了以下故事内容：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

这是用户提供的故事元素：
<STORY_ELEMENTS>
{_StoryElements}
</STORY_ELEMENTS>

这是整理后的故事大纲：
<OUTLINE>
{_Outline}
</OUTLINE>

在<USER_PROMPT>部分用户提供了很丰富的情节和故事元素，大部分已经包含在了<STORY_ELEMENTS>部分和<OUTLINE>部分中。你的任务是提取不包含在<STORY_ELEMENTS>和<OUTLINE>部分的用户需求，并将其整理成清晰的 Markdown 格式。

请从用户提供的内容中提取以下内容：
- 对故事的整体愿景和主题的描述
- 用户对情节的偏好，如着重描写的情感、动作、对话等
- 用户对细节的偏好，如角色服装，角色口头禅，细节描述侧重点等
- 用户对文风、节奏、主题等的要求
- 用户对章节长度的要求
- 用户不希望出现的内容或元素
请确保提取的内容是清晰和具体的，尽可能保留用户的原意和表达方式。请以以下格式输出：

# 故事标题
 [用户提供的故事标题，如果没有则从其他部分提取]

## 故事愿景和主题
- **概括**：精简地概括用户的故事情节。

## 用户偏好
  [列举用户对情节的偏好]

## 用户不希望出现的内容
  [列举用户不希望出现的内容]

"""

CLEAN_OUTLINE_PROMPT = """
用户给出了以下故事内容，其中已经包含完整的大纲：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

这是用户提供的故事元素：
<STORY_ELEMENTS>
{_StoryElements}
</STORY_ELEMENTS>


您需要做的事情包括：
- 将用户提供的内容整理成清晰的 Markdown 格式的大纲。
- 尽最大可能保留用户提供的原始内容，尤其是用户的情节描述和细节要求。
- 如用户明确强调了某些因果关系，请务必确保这些因果关系在大纲中得到体现。
- 如用户对某一节有字数、节奏等要求，请保留这些要求。
- 如用户强调某些人物在特定时刻会做出特定行为，或者有特定的情感反应，请确保这些重要细节被保留在大纲中。这些是关键情节。
- 如用户声明"需要您创作具体细节"，请根据用户的需求和故事元素，创作出具体的情节细节，并将其添加到大纲中。
- 确保大纲的每一章都能形成一个完整的故事结构。

您不应该做的事情包括：
- 绝对不要省略任何一个章节！
- 不要额外添加章节。
- 不要省略用户提供的任何重要情节或细节。
- 不要省略任何和因果关系有关的细节。
- 不要把模板中的 XML 标签以及模板中的示例内容包含在您的输出中。

"""

INITIAL_OUTLINE_PROMPT = """
请根据以下提示撰写一份 Markdown 格式的大纲：

<PROMPT>
{_Prompt}
</PROMPT>

<ELEMENTS>
{_StoryElements}
</ELEMENTS>

写作时，请考虑以下几点：
- 整个故事的核心矛盾以及每一章的矛盾。
- 每一章涉及的角色。
- 角色之间的人际关系和利害关系。
- 角色的动机和目标。
- 故事在每一章的发展。
- 冲突的目标或解决方案。
- 如果用户的要求比较特殊，您需要在大纲中添加相应的内容。

您需要注意的事情包括：
- 您的大纲应包含每一个章节的内容。
- 您的大纲应依照章节进行划分。
- 每一个章节之前都需要明确是第几章，如“第一章”、“第二章”等。章节编号应从1开始，且为整数。
- 您的大纲应符合一定的markdown格式。
- 提纲清晰地阐明哪些内容位于哪个章节。

您不应该做的事情包括：
- 不要直接回答任何问题。
- 不要省略任何章节。
- 不要使用非整数章节编号，以及无数字的章节编号。（如番外篇，序章等）
- 不要把模板中的 XML 标签以及模板中的示例内容包含在您的输出中。


不要直接回答这些问题，而是让你的大纲含蓄地回答它们。（展现，而不是讲述），这很重要。

请确保你的大纲清晰地说明哪些内容属于哪个章节。
确保在写作时添加大量细节。

此外，还要包含关于不同角色的信息，以及他们在故事发展过程中如何变化。
我们希望看到丰富而复杂的角色发展！"""

OUTLINE_REVISION_PROMPT = """
基于以下需求：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

根据以下反馈：
<FEEDBACK>
{_Feedback}
</FEEDBACK>

请修改以下提纲：
<OUTLINE>
{_Outline}
</OUTLINE>


请修改您的提纲并添加内容，使其尽可能完美！

写作时，请考虑以下几点：
- 整个故事的核心矛盾以及每一章的矛盾。
- 每一章涉及的角色。
- 角色之间的人际关系和利害关系。
- 角色的动机和目标。
- 故事在每一章的发展。
- 冲突的目标或解决方案。

您需要注意的事情包括：
- 您的大纲应包含每一个章节的内容。
- 您的大纲应依照章节进行划分。
- 每一个章节之前都需要明确是第几章，如“第一章”、“第二章”等。
- 您的大纲应符合一定的markdown格式。
- 提纲清晰地阐明哪些内容位于哪个章节。
- 如果需要添加或删除章节，请修改其它章节的章节编号，使得章节编号连续。
- 如果用户的要求比较特殊，您需要在大纲中添加相应的内容。

您不应该做的事情包括：
- 不要直接回答任何问题。
- 不要省略任何章节。
- 不要在提纲中包含修改的痕迹。避免如"新增了一个场景"、"修改了角色关系"等字样。
- 不要在提纲中包含任何关于修改的说明或注释。
- 不要使用非整数章节编号，以及无数字的章节编号。（如番外篇，序章，新增章节等）
- 除非反馈中要求合并章节，否则不要删除或合并任何章节。
- 除非反馈中要求添加章节，否则不要添加新的章节。
- 不要把模板中的 XML 标签以及模板中的示例内容包含在您的输出中。


"""

CHAPTER_OUTLINE_PROMPT = """
请根据提供的提纲，为第 {_ChapterNum} 章生成详细的章节大纲。
基于以下需求：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

基于以下故事总体大纲：
<OUTLINE>
{_Outline}
</OUTLINE>

写作时，您需要做的事情包括：
- 明确本章的核心冲突和推动故事发展的关键事件。
- 明确本章涉及的主要角色（至少两位），并简要描述他们的动机、关系和变化。
- 详细描述本章的故事进展，包括每个场景的起因、经过和结果。
- 明确每个场景的地点、时间、氛围和情感基调。
- 充分展现角色之间的互动、对话和冲突，突出人物性格和关系变化。
- 保留原提纲中本章的全部内容，并在此基础上进行扩展和细化，补充细节和因果关系。
- 每个场景应包含关键事件、重要对话、转折点或悬念，推动故事向下一章发展。
- 如有必要，补充文学手法（如伏笔、象征、对比等），增强故事层次感。
- 章节大纲应结构清晰，内容具体，便于后续细化为故事正文。

您不应该做的事情包括：
- 不要直接回答任何问题。
- 不要添加超过4个场景。
- 不得省略原提纲中第{_ChapterNum}章的任何内容。
- 不得包含上一章或下一章的内容。



请将您的回答分解成几个场景，每个场景遵循以下格式（请为章节中的每个场景重复该场景格式）：

# 章节 {_ChapterNum}

## 场景：[简要场景标题]

- **人物与背景：**
- 角色：[角色名称] - [简要描述]
- 地点：[场景地点]
- 时间：[场景发生时间]

- **冲突与基调：**
- 冲突：[类型与描述]
- 基调：[情感基调]

- **因果关系：**
- [描述当前章节出现的一些情节与其它情节之间的因果关系]

- **情节概述：**
- [描述该场景的主要情节和发展，包含但不限于原提纲中该场景的内容，使用S-V-O简单句式，可以罗列4-8个左右的事件]

- **关键事件与对话：**
- [描述重要事件、动作或对话]

- **文学手法：**
- [伏笔、象征或其他手法（如有）]

- **结局与引入：**
- [场景如何结束以及如何与下一个场景衔接]

请确保每个场景都具体、细致，突出角色动机、冲突和情感变化。不得省略原提纲中第{_ChapterNum}章的任何内容。章节仅包含与第{_ChapterNum}章相关的内容。

确保您的章节名称符合 Markdown 格式！
"""


CHAPTER_OUTLINE_FILTER_PROMPT = """
请根据提供的提纲，为第 {_ChapterNum} 章生成详细的章节大纲。
基于以下需求：
<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

基于以下故事总体大纲：
<OUTLINE>
{_Outline}
</OUTLINE>

请剔除以下大纲中不属于第 {_ChapterNum} 章的场景：
<CHAPTER_OUTLINE>
{_ChapterOutline}
</CHAPTER_OUTLINE>

修改时，您需要做的事情包括：
- 判断每一个场景是否属于总体大纲中的第 {_ChapterNum} 章。
- 如果场景属于第 {_ChapterNum} 章，请**原封不动**地保留该场景。
- 如果场景不属于第 {_ChapterNum} 章，请将其删除。
- 如果没有需要删除的场景，请原封不动地返回章节大纲。

您不应该做的事情包括：
- 不能修改未删除的场景的内容。
- 不要添加新的场景。

"""



GET_IMPORTANT_BASE_INFO_PROMPT = """
请从以下用户提示中提取任何重要信息：

<USER_PROMPT>
{_Prompt}
</USER_PROMPT>

只需写下提纲中未涵盖的任何信息即可。
请使用以下模板来格式化您的回复。
这些内容包括章节长度说明、整体愿景、格式说明等。
（请勿使用 XML 标签 - 这些仅供参考）

<示例>
# 重要补充说明
- 重点 1
- 重点 2
</示例>

请勿撰写提纲本身，只需添加一些补充说明即可。请保持您的回复简短。

"""

